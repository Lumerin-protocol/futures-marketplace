# Aderyn Analysis Report

This report was generated by [Aderyn](https://github.com/Cyfrin/aderyn), a static analysis tool built by [Cyfrin](https://cyfrin.io), a blockchain security company. This report is not a substitute for manual audit or security review. It should not be relied upon for any purpose other than to assist in the identification of potential security vulnerabilities.
# Table of Contents

- [Summary](#summary)
  - [Files Summary](#files-summary)
  - [Files Details](#files-details)
  - [Issue Summary](#issue-summary)
- [High Issues](#high-issues)
  - [H-1: Contract Name Reused in Different Files](#h-1-contract-name-reused-in-different-files)
  - [H-2: ETH transferred without address checks](#h-2-eth-transferred-without-address-checks)
  - [H-3: Weak Randomness](#h-3-weak-randomness)
  - [H-4: Contract locks Ether without a withdraw function](#h-4-contract-locks-ether-without-a-withdraw-function)
- [Low Issues](#low-issues)
  - [L-1: Centralization Risk](#l-1-centralization-risk)
  - [L-2: Unsafe ERC20 Operation](#l-2-unsafe-erc20-operation)
  - [L-3: Unspecific Solidity Pragma](#l-3-unspecific-solidity-pragma)
  - [L-4: Address State Variable Set Without Checks](#l-4-address-state-variable-set-without-checks)
  - [L-5: Public Function Not Used Internally](#l-5-public-function-not-used-internally)
  - [L-6: Literal Instead of Constant](#l-6-literal-instead-of-constant)
  - [L-7: PUSH0 Opcode](#l-7-push0-opcode)
  - [L-8: Modifier Invoked Only Once](#l-8-modifier-invoked-only-once)
  - [L-9: Empty Block](#l-9-empty-block)
  - [L-10: Large Numeric Literal](#l-10-large-numeric-literal)
  - [L-11: Contract has TODO Comments](#l-11-contract-has-todo-comments)
  - [L-12: Unused Error](#l-12-unused-error)
  - [L-13: Loop Contains `require`/`revert`](#l-13-loop-contains-requirerevert)
  - [L-14: Incorrect Order of Division and Multiplication](#l-14-incorrect-order-of-division-and-multiplication)
  - [L-15: Costly operations inside loop](#l-15-costly-operations-inside-loop)
  - [L-16: Unused Import](#l-16-unused-import)
  - [L-17: State Change Without Event](#l-17-state-change-without-event)
  - [L-18: Unchecked Return](#l-18-unchecked-return)


# Summary

## Files Summary

| Key | Value |
| --- | --- |
| .sol Files | 6 |
| Total nSLOC | 1010 |


## Files Details

| Filepath | nSLOC |
| --- | --- |
| contracts/Futures.sol | 834 |
| contracts/USDCMock.sol | 11 |
| contracts/Versionable.sol | 4 |
| contracts/hardhat.sol | 4 |
| contracts/multicall-embedded.sol | 4 |
| contracts/multicall3.sol | 153 |
| **Total** | **1010** |


## Issue Summary

| Category | No. of Issues |
| --- | --- |
| High | 4 |
| Low | 18 |


# High Issues

## H-1: Contract Name Reused in Different Files

When compiling contracts with certain development frameworks (for example: Truffle), having contracts with the same name across different files can lead to one being overwritten.

<details><summary>1 Found Instances</summary>


- Found in contracts/Versionable.sol [Line: 4](contracts/Versionable.sol#L4)

	```solidity
	interface Versionable {
	```

</details>



## H-2: ETH transferred without address checks

Consider introducing checks for `msg.sender` to ensure the recipient of the money is as intended.

<details><summary>1 Found Instances</summary>


- Found in contracts/multicall3.sol [Line: 147](contracts/multicall3.sol#L147)

	```solidity
	    function aggregate3Value(Call3Value[] calldata calls) public payable returns (Result[] memory returnData) {
	```

</details>



## H-3: Weak Randomness

The use of keccak256 hash functions on predictable values like block.timestamp, block.number, or similar data, including modulo operations on these values, should be avoided for generating randomness, as they are easily predictable and manipulable. The `PREVRANDAO` opcode also should not be used as a source of randomness. Instead, utilize Chainlink VRF for cryptographically secure and provably random values to ensure protocol integrity.

<details><summary>3 Found Instances</summary>


- Found in contracts/Futures.sol [Line: 305](contracts/Futures.sol#L305)

	```solidity
	            keccak256(abi.encode(_participant, _pricePerDay, _deliveryAt, _isBuy, block.timestamp, nonce++));
	```

- Found in contracts/Futures.sol [Line: 385](contracts/Futures.sol#L385)

	```solidity
	        bytes32 positionId = keccak256(
	```

- Found in contracts/multicall3.sol [Line: 203](contracts/multicall3.sol#L203)

	```solidity
	        difficulty = block.prevrandao;
	```

</details>



## H-4: Contract locks Ether without a withdraw function

It appears that the contract includes a payable function to accept Ether but lacks a corresponding function to withdraw it, which leads to the Ether being locked in the contract. To resolve this issue, please implement a public or external function that allows for the withdrawal of Ether from the contract.

<details><summary>1 Found Instances</summary>


- Found in contracts/Futures.sol [Line: 21](contracts/Futures.sol#L21)

	```solidity
	contract Futures is UUPSUpgradeable, OwnableUpgradeable, ERC20Upgradeable, MulticallUpgradeable, Versionable {
	```

</details>



# Low Issues

## L-1: Centralization Risk

Contracts have owners with privileged rights to perform admin tasks and need to be trusted to not perform malicious updates or drain funds.

<details><summary>11 Found Instances</summary>


- Found in contracts/Futures.sol [Line: 176](contracts/Futures.sol#L176)

	```solidity
	    function _authorizeUpgrade(address newImplementation) internal override onlyOwner {
	```

- Found in contracts/Futures.sol [Line: 235](contracts/Futures.sol#L235)

	```solidity
	    function setFeeDiscountPercent(address _address, uint8 _feeDiscountPercent) external onlyOwner {
	```

- Found in contracts/Futures.sol [Line: 460](contracts/Futures.sol#L460)

	```solidity
	    function setBreachPenaltyRatePerDay(uint256 _breachPenaltyRatePerDay) external onlyOwner {
	```

- Found in contracts/Futures.sol [Line: 467](contracts/Futures.sol#L467)

	```solidity
	    function setLiquidationMarginPercent(uint8 _liquidationMarginPercent) external onlyOwner {
	```

- Found in contracts/Futures.sol [Line: 471](contracts/Futures.sol#L471)

	```solidity
	    function setFutureDeliveryDatesCount(uint8 _futureDeliveryDatesCount) public onlyOwner {
	```

- Found in contracts/Futures.sol [Line: 478](contracts/Futures.sol#L478)

	```solidity
	    function setOrderFee(uint256 _orderFee) external onlyOwner {
	```

- Found in contracts/Futures.sol [Line: 483](contracts/Futures.sol#L483)

	```solidity
	    function setOracle(address addr) external onlyOwner {
	```

- Found in contracts/Futures.sol [Line: 489](contracts/Futures.sol#L489)

	```solidity
	    function setValidatorURL(string memory _validatorURL) external onlyOwner {
	```

- Found in contracts/Futures.sol [Line: 496](contracts/Futures.sol#L496)

	```solidity
	    function setValidatorAddress(address _validatorAddress) external onlyOwner {
	```

- Found in contracts/Futures.sol [Line: 1013](contracts/Futures.sol#L1013)

	```solidity
	    function withdrawReservePool(uint256 _amount) external onlyOwner {
	```

- Found in contracts/Futures.sol [Line: 1022](contracts/Futures.sol#L1022)

	```solidity
	    function withdrawCollectedFees() external onlyOwner {
	```

</details>



## L-2: Unsafe ERC20 Operation

ERC20 functions may not behave as expected. For example: return values are not always meaningful. It is recommended to use OpenZeppelin's SafeERC20 library.

<details><summary>1 Found Instances</summary>


- Found in contracts/Futures.sol [Line: 1048](contracts/Futures.sol#L1048)

	```solidity
	        return super.transfer(_to, _amount);
	```

</details>



## L-3: Unspecific Solidity Pragma

Consider using a specific version of Solidity in your contracts instead of a wide version. For example, instead of `pragma solidity ^0.8.0;`, use `pragma solidity 0.8.0;`

<details><summary>6 Found Instances</summary>


- Found in contracts/Futures.sol [Line: 2](contracts/Futures.sol#L2)

	```solidity
	pragma solidity ^0.8.20;
	```

- Found in contracts/USDCMock.sol [Line: 2](contracts/USDCMock.sol#L2)

	```solidity
	pragma solidity >0.8.10;
	```

- Found in contracts/Versionable.sol [Line: 2](contracts/Versionable.sol#L2)

	```solidity
	pragma solidity ^0.8.0;
	```

- Found in contracts/hardhat.sol [Line: 2](contracts/hardhat.sol#L2)

	```solidity
	pragma solidity >=0.8.4;
	```

- Found in contracts/multicall-embedded.sol [Line: 2](contracts/multicall-embedded.sol#L2)

	```solidity
	pragma solidity ^0.8.20;
	```

- Found in contracts/multicall3.sol [Line: 2](contracts/multicall3.sol#L2)

	```solidity
	pragma solidity >=0.8.26;
	```

</details>



## L-4: Address State Variable Set Without Checks

Check for `address(0)` when assigning values to address state variables.

<details><summary>5 Found Instances</summary>


- Found in contracts/Futures.sol [Line: 158](contracts/Futures.sol#L158)

	```solidity
	        hashrateOracle = _hashrateOracle;
	```

- Found in contracts/Futures.sol [Line: 159](contracts/Futures.sol#L159)

	```solidity
	        validatorAddress = _validatorAddress;
	```

- Found in contracts/Futures.sol [Line: 173](contracts/Futures.sol#L173)

	```solidity
	        token = _token;
	```

- Found in contracts/Futures.sol [Line: 484](contracts/Futures.sol#L484)

	```solidity
	        hashrateOracle = HashrateOracle(addr);
	```

- Found in contracts/Futures.sol [Line: 497](contracts/Futures.sol#L497)

	```solidity
	        validatorAddress = _validatorAddress;
	```

</details>



## L-5: Public Function Not Used Internally

If a function is marked public but is not used internally, consider marking it as `external`.

<details><summary>15 Found Instances</summary>


- Found in contracts/Futures.sol [Line: 143](contracts/Futures.sol#L143)

	```solidity
	    function initialize(
	```

- Found in contracts/multicall3.sol [Line: 41](contracts/multicall3.sol#L41)

	```solidity
	    function aggregate(Call[] calldata calls) public payable returns (uint256 blockNumber, bytes[] memory returnData) {
	```

- Found in contracts/multicall3.sol [Line: 103](contracts/multicall3.sol#L103)

	```solidity
	    function blockAndAggregate(Call[] calldata calls)
	```

- Found in contracts/multicall3.sol [Line: 114](contracts/multicall3.sol#L114)

	```solidity
	    function aggregate3(Call3[] calldata calls) public payable returns (Result[] memory returnData) {
	```

- Found in contracts/multicall3.sol [Line: 147](contracts/multicall3.sol#L147)

	```solidity
	    function aggregate3Value(Call3Value[] calldata calls) public payable returns (Result[] memory returnData) {
	```

- Found in contracts/multicall3.sol [Line: 187](contracts/multicall3.sol#L187)

	```solidity
	    function getBlockHash(uint256 blockNumber) public view returns (bytes32 blockHash) {
	```

- Found in contracts/multicall3.sol [Line: 192](contracts/multicall3.sol#L192)

	```solidity
	    function getBlockNumber() public view returns (uint256 blockNumber) {
	```

- Found in contracts/multicall3.sol [Line: 197](contracts/multicall3.sol#L197)

	```solidity
	    function getCurrentBlockCoinbase() public view returns (address coinbase) {
	```

- Found in contracts/multicall3.sol [Line: 202](contracts/multicall3.sol#L202)

	```solidity
	    function getCurrentBlockDifficulty() public view returns (uint256 difficulty) {
	```

- Found in contracts/multicall3.sol [Line: 207](contracts/multicall3.sol#L207)

	```solidity
	    function getCurrentBlockGasLimit() public view returns (uint256 gaslimit) {
	```

- Found in contracts/multicall3.sol [Line: 212](contracts/multicall3.sol#L212)

	```solidity
	    function getCurrentBlockTimestamp() public view returns (uint256 timestamp) {
	```

- Found in contracts/multicall3.sol [Line: 217](contracts/multicall3.sol#L217)

	```solidity
	    function getEthBalance(address addr) public view returns (uint256 balance) {
	```

- Found in contracts/multicall3.sol [Line: 222](contracts/multicall3.sol#L222)

	```solidity
	    function getLastBlockHash() public view returns (bytes32 blockHash) {
	```

- Found in contracts/multicall3.sol [Line: 230](contracts/multicall3.sol#L230)

	```solidity
	    function getBasefee() public view returns (uint256 basefee) {
	```

- Found in contracts/multicall3.sol [Line: 235](contracts/multicall3.sol#L235)

	```solidity
	    function getChainId() public view returns (uint256 chainid) {
	```

</details>



## L-6: Literal Instead of Constant

Define and use `constant` variables instead of using literals. If the same constant literal value is used multiple times, create a constant state variable and reference it throughout the contract.

<details><summary>6 Found Instances</summary>


- Found in contracts/Futures.sol [Line: 224](contracts/Futures.sol#L224)

	```solidity
	        return orderFee - orderFee * feeDiscountPercent / 100;
	```

- Found in contracts/Futures.sol [Line: 236](contracts/Futures.sol#L236)

	```solidity
	        if (_feeDiscountPercent > 100) {
	```

- Found in contracts/Futures.sol [Line: 237](contracts/Futures.sol#L237)

	```solidity
	            revert ValueOutOfRange(0, 100);
	```

- Found in contracts/Futures.sol [Line: 502](contracts/Futures.sol#L502)

	```solidity
	        return _entryPricePerDay * deliveryDurationDays * abs(_qty) * getMarginPercent() / 100;
	```

- Found in contracts/Futures.sol [Line: 555](contracts/Futures.sol#L555)

	```solidity
	            uint8(breachPenaltyRatePerDay * deliveryDurationSeconds() / 10 ** (BREACH_PENALTY_DECIMALS - 2));
	```

- Found in contracts/Futures.sol [Line: 725](contracts/Futures.sol#L725)

	```solidity
	        return _price * breachPenaltyRatePerDay * remainingTime / SECONDS_PER_DAY / 10 ** BREACH_PENALTY_DECIMALS;
	```

</details>



## L-7: PUSH0 Opcode

Solc compiler version 0.8.20 switches the default target EVM version to Shanghai, which means that the generated bytecode will include PUSH0 opcodes. Be sure to select the appropriate EVM version in case you intend to deploy on a chain other than mainnet like L2 chains that may not support PUSH0, otherwise deployment of your contracts will fail.

<details><summary>6 Found Instances</summary>


- Found in contracts/Futures.sol [Line: 2](contracts/Futures.sol#L2)

	```solidity
	pragma solidity ^0.8.20;
	```

- Found in contracts/USDCMock.sol [Line: 2](contracts/USDCMock.sol#L2)

	```solidity
	pragma solidity >0.8.10;
	```

- Found in contracts/Versionable.sol [Line: 2](contracts/Versionable.sol#L2)

	```solidity
	pragma solidity ^0.8.0;
	```

- Found in contracts/hardhat.sol [Line: 2](contracts/hardhat.sol#L2)

	```solidity
	pragma solidity >=0.8.4;
	```

- Found in contracts/multicall-embedded.sol [Line: 2](contracts/multicall-embedded.sol#L2)

	```solidity
	pragma solidity ^0.8.20;
	```

- Found in contracts/multicall3.sol [Line: 2](contracts/multicall3.sol#L2)

	```solidity
	pragma solidity >=0.8.26;
	```

</details>



## L-8: Modifier Invoked Only Once

Consider removing the modifier or inlining the logic into the calling function.

<details><summary>1 Found Instances</summary>


- Found in contracts/Futures.sol [Line: 1083](contracts/Futures.sol#L1083)

	```solidity
	    modifier onlyValidator() {
	```

</details>



## L-9: Empty Block

Consider removing empty blocks.

<details><summary>1 Found Instances</summary>


- Found in contracts/Futures.sol [Line: 176](contracts/Futures.sol#L176)

	```solidity
	    function _authorizeUpgrade(address newImplementation) internal override onlyOwner {
	```

</details>



## L-10: Large Numeric Literal

Large literal values multiples of 10000 can be replaced with scientific notation.Use `e` notation, for example: `1e18`, instead of its full numeric value.

<details><summary>1 Found Instances</summary>


- Found in contracts/USDCMock.sol [Line: 10](contracts/USDCMock.sol#L10)

	```solidity
	        _mint(msg.sender, 1_000_000 * 10 ** DECIMALS);
	```

</details>



## L-11: Contract has TODO Comments

Contract contains comments with TODOS. Consider implementing or removing them.

<details><summary>1 Found Instances</summary>


- Found in contracts/Futures.sol [Line: 21](contracts/Futures.sol#L21)

	```solidity
	contract Futures is UUPSUpgradeable, OwnableUpgradeable, ERC20Upgradeable, MulticallUpgradeable, Versionable {
	```

</details>



## L-12: Unused Error

Consider using or removing the unused error.

<details><summary>1 Found Instances</summary>


- Found in contracts/Futures.sol [Line: 123](contracts/Futures.sol#L123)

	```solidity
	    error OrderNotBelongToSender();
	```

</details>



## L-13: Loop Contains `require`/`revert`

Avoid `require` / `revert` statements in a loop because a single bad item can cause the whole transaction to fail. It's better to forgive on fail and return failed elements post processing of the loop

<details><summary>7 Found Instances</summary>


- Found in contracts/Futures.sol [Line: 199](contracts/Futures.sol#L199)

	```solidity
	        for (uint8 i = 0; i < abs8(_qty); i++) {
	```

- Found in contracts/Futures.sol [Line: 589](contracts/Futures.sol#L589)

	```solidity
	        for (; _positions.length() > 0;) {
	```

- Found in contracts/Futures.sol [Line: 841](contracts/Futures.sol#L841)

	```solidity
	        for (uint256 i = 0; i < _positions.length(); i++) {
	```

- Found in contracts/Futures.sol [Line: 860](contracts/Futures.sol#L860)

	```solidity
	        for (uint256 i = 0; i < _positionIds.length; i++) {
	```

- Found in contracts/Futures.sol [Line: 891](contracts/Futures.sol#L891)

	```solidity
	        for (uint256 i = 0; i < _positions.length(); i++) {
	```

- Found in contracts/multicall3.sol [Line: 46](contracts/multicall3.sol#L46)

	```solidity
	        for (uint256 i = 0; i < length;) {
	```

- Found in contracts/multicall3.sol [Line: 70](contracts/multicall3.sol#L70)

	```solidity
	        for (uint256 i = 0; i < length;) {
	```

</details>



## L-14: Incorrect Order of Division and Multiplication

Division operations followed directly by multiplication operations can lead to precision loss due to the way integer arithmetic is handled in Solidity./
        Consider Multiplication before Division.

<details><summary>1 Found Instances</summary>


- Found in contracts/Futures.sol [Line: 935](contracts/Futures.sol#L935)

	```solidity
	        return (_value + _increment / 2) / _increment * _increment;
	```

</details>



## L-15: Costly operations inside loop

Invoking `SSTORE` operations in loops may waste gas. Use a local variable to hold the loop computation result.

<details><summary>7 Found Instances</summary>


- Found in contracts/Futures.sol [Line: 199](contracts/Futures.sol#L199)

	```solidity
	        for (uint8 i = 0; i < abs8(_qty); i++) {
	```

- Found in contracts/Futures.sol [Line: 423](contracts/Futures.sol#L423)

	```solidity
	        for (uint256 i = ordersLength; i > 0; i--) {
	```

- Found in contracts/Futures.sol [Line: 573](contracts/Futures.sol#L573)

	```solidity
	        for (; _orders.length() > 0;) {
	```

- Found in contracts/Futures.sol [Line: 589](contracts/Futures.sol#L589)

	```solidity
	        for (; _positions.length() > 0;) {
	```

- Found in contracts/Futures.sol [Line: 841](contracts/Futures.sol#L841)

	```solidity
	        for (uint256 i = 0; i < _positions.length(); i++) {
	```

- Found in contracts/Futures.sol [Line: 860](contracts/Futures.sol#L860)

	```solidity
	        for (uint256 i = 0; i < _positionIds.length; i++) {
	```

- Found in contracts/Futures.sol [Line: 891](contracts/Futures.sol#L891)

	```solidity
	        for (uint256 i = 0; i < _positions.length(); i++) {
	```

</details>



## L-16: Unused Import

Redundant import statement. Consider removing it.

<details><summary>3 Found Instances</summary>


- Found in contracts/hardhat.sol [Line: 4](contracts/hardhat.sol#L4)

	```solidity
	import "@openzeppelin/contracts/proxy/beacon/UpgradeableBeacon.sol";
	```

- Found in contracts/hardhat.sol [Line: 5](contracts/hardhat.sol#L5)

	```solidity
	import "@openzeppelin/contracts/proxy/ERC1967/ERC1967Proxy.sol";
	```

- Found in contracts/hardhat.sol [Line: 6](contracts/hardhat.sol#L6)

	```solidity
	import "hashprice-oracle/contracts/contracts/BTCPriceOracleMock.sol";
	```

</details>



## L-17: State Change Without Event

There are state variable changes in this function but no event is emitted. Consider emitting an event to enable offchain indexers to track the changes.

<details><summary>6 Found Instances</summary>


- Found in contracts/Futures.sol [Line: 235](contracts/Futures.sol#L235)

	```solidity
	    function setFeeDiscountPercent(address _address, uint8 _feeDiscountPercent) external onlyOwner {
	```

- Found in contracts/Futures.sol [Line: 460](contracts/Futures.sol#L460)

	```solidity
	    function setBreachPenaltyRatePerDay(uint256 _breachPenaltyRatePerDay) external onlyOwner {
	```

- Found in contracts/Futures.sol [Line: 467](contracts/Futures.sol#L467)

	```solidity
	    function setLiquidationMarginPercent(uint8 _liquidationMarginPercent) external onlyOwner {
	```

- Found in contracts/Futures.sol [Line: 471](contracts/Futures.sol#L471)

	```solidity
	    function setFutureDeliveryDatesCount(uint8 _futureDeliveryDatesCount) public onlyOwner {
	```

- Found in contracts/Futures.sol [Line: 483](contracts/Futures.sol#L483)

	```solidity
	    function setOracle(address addr) external onlyOwner {
	```

- Found in contracts/Futures.sol [Line: 496](contracts/Futures.sol#L496)

	```solidity
	    function setValidatorAddress(address _validatorAddress) external onlyOwner {
	```

</details>



## L-18: Unchecked Return

Function returns a value but it is ignored. Consider checking the return value.

<details><summary>18 Found Instances</summary>


- Found in contracts/Futures.sol [Line: 182](contracts/Futures.sol#L182)

	```solidity
	        removeOutdatedOrdersForParticipant(_msgSender());
	```

- Found in contracts/Futures.sol [Line: 264](contracts/Futures.sol#L264)

	```solidity
	            orderIndexId.pushBack(uint256(_orderId));
	```

- Found in contracts/Futures.sol [Line: 265](contracts/Futures.sol#L265)

	```solidity
	            participantOrders.add(_orderId);
	```

- Found in contracts/Futures.sol [Line: 266](contracts/Futures.sol#L266)

	```solidity
	            participantPriceOrderIds.add(_orderId);
	```

- Found in contracts/Futures.sol [Line: 398](contracts/Futures.sol#L398)

	```solidity
	        participantPositionIdsIndex[_temp.seller].add(positionId);
	```

- Found in contracts/Futures.sol [Line: 399](contracts/Futures.sol#L399)

	```solidity
	        participantPositionIdsIndex[_temp.buyer].add(positionId);
	```

- Found in contracts/Futures.sol [Line: 400](contracts/Futures.sol#L400)

	```solidity
	        participantDeliveryDatePositionIdsIndex[_temp.seller][order.deliveryAt].add(positionId);
	```

- Found in contracts/Futures.sol [Line: 401](contracts/Futures.sol#L401)

	```solidity
	        participantDeliveryDatePositionIdsIndex[_temp.buyer][order.deliveryAt].add(positionId);
	```

- Found in contracts/Futures.sol [Line: 438](contracts/Futures.sol#L438)

	```solidity
	        orderIndexId.remove(uint256(orderId));
	```

- Found in contracts/Futures.sol [Line: 440](contracts/Futures.sol#L440)

	```solidity
	        participantOrderIdsIndex[order.participant].remove(orderId);
	```

- Found in contracts/Futures.sol [Line: 441](contracts/Futures.sol#L441)

	```solidity
	        participantDeliveryDatePriceOrderIdsIndex[order.participant][order.deliveryAt][order.pricePerDay].remove(
	```

- Found in contracts/Futures.sol [Line: 597](contracts/Futures.sol#L597)

	```solidity
	            _forceLiquidatePosition(positionId, position, _participant);
	```

- Found in contracts/Futures.sol [Line: 749](contracts/Futures.sol#L749)

	```solidity
	        _createOrMatchSingleOrder(
	```

- Found in contracts/Futures.sol [Line: 766](contracts/Futures.sol#L766)

	```solidity
	        participantDeliveryDatePositionIdsIndex[position.seller][position.deliveryAt].remove(_positionId);
	```

- Found in contracts/Futures.sol [Line: 767](contracts/Futures.sol#L767)

	```solidity
	        participantDeliveryDatePositionIdsIndex[position.buyer][position.deliveryAt].remove(_positionId);
	```

- Found in contracts/Futures.sol [Line: 768](contracts/Futures.sol#L768)

	```solidity
	        participantPositionIdsIndex[position.seller].remove(_positionId);
	```

- Found in contracts/Futures.sol [Line: 769](contracts/Futures.sol#L769)

	```solidity
	        participantPositionIdsIndex[position.buyer].remove(_positionId);
	```

- Found in contracts/Futures.sol [Line: 876](contracts/Futures.sol#L876)

	```solidity
	            _transferEnsureMarginBalance(position.buyer, address(this), totalPayment);
	```

</details>



